{"version":3,"sources":["Gzip.js"],"names":["define","Zlib","CRC32","RawDeflate","Gzip","input","opt_params","this","ip","output","op","flags","filename","comment","deflateOptions","DefaultBufferSize","prototype","compress","flg","mtime","crc16","crc32","rawdeflate","c","i","il","Uint8Array","FlagsMask","FNAME","FCOMMENT","FHCRC","Date","now","OperatingSystem","UNKNOWN","length","charCodeAt","calc","buffer","byteLength","set","subarray","FAT","AMIGA","VMS","UNIX","VM_CMS","ATARI_TOS","HPFS","MACINTOSH","Z_SYSTEM","CP_M","TOPS_20","NTFS","QDOS","ACORN_RISCOS","FTEXT","FEXTRA"],"mappings":"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","file":"../Gzip.js","sourcesContent":["define([\n  \"./zlib\",\n  \"../crc32\",\n  \"./RawDeflate\"\n],function(Zlib,CRC32,RawDeflate) {\n  /**\n   * @fileoverview GZIP (RFC1952) 実装.\n   */\n\n  const USE_TYPEDARRAY = true;\n\n  /**\n   * @constructor\n   * @param {!(Array|Uint8Array)} input input buffer.\n   * @param {Object=} opt_params option parameters.\n   */\n  var Gzip = function(input, opt_params) {\n    /** @type {!(Array.<number>|Uint8Array)} input buffer. */\n    this.input = input;\n    /** @type {number} input buffer pointer. */\n    this.ip = 0;\n    /** @type {!(Array.<number>|Uint8Array)} output buffer. */\n    this.output;\n    /** @type {number} output buffer. */\n    this.op = 0;\n    /** @type {!Object} flags option flags. */\n    this.flags = {};\n    /** @type {!string} filename. */\n    this.filename;\n    /** @type {!string} comment. */\n    this.comment;\n    /** @type {!Object} deflate options. */\n    this.deflateOptions;\n\n    // option parameters\n    if (opt_params) {\n      if (opt_params['flags']) {\n        this.flags = opt_params['flags'];\n      }\n      if (typeof opt_params['filename'] === 'string') {\n        this.filename = opt_params['filename'];\n      }\n      if (typeof opt_params['comment'] === 'string') {\n        this.comment = opt_params['comment'];\n      }\n      if (opt_params['deflateOptions']) {\n        this.deflateOptions = opt_params['deflateOptions'];\n      }\n    }\n\n    if (!this.deflateOptions) {\n      this.deflateOptions = {};\n    }\n  };\n\n  /**\n   * @type {number}\n   * @const\n   */\n  Gzip.DefaultBufferSize = 0x8000;\n\n  /**\n   * encode gzip members.\n   * @return {!(Array|Uint8Array)} gzip binary array.\n   */\n  Gzip.prototype.compress = function() {\n    /** @type {number} flags. */\n    var flg;\n    /** @type {number} modification time. */\n    var mtime;\n    /** @type {number} CRC-16 value for FHCRC flag. */\n    var crc16;\n    /** @type {number} CRC-32 value for verification. */\n    var crc32;\n    /** @type {!RawDeflate} raw deflate object. */\n    var rawdeflate;\n    /** @type {number} character code */\n    var c;\n    /** @type {number} loop counter. */\n    var i;\n    /** @type {number} loop limiter. */\n    var il;\n    /** @type {!(Array|Uint8Array)} output buffer. */\n    var output =\n      new (USE_TYPEDARRAY ? Uint8Array : Array)(Gzip.DefaultBufferSize);\n    /** @type {number} output buffer pointer. */\n    var op = 0;\n\n    var input = this.input;\n    var ip = this.ip;\n    var filename = this.filename;\n    var comment = this.comment;\n\n    // check signature\n    output[op++] = 0x1f;\n    output[op++] = 0x8b;\n\n    // check compression method\n    output[op++] = 8; /* XXX: use Zlib const */\n\n    // flags\n    flg = 0;\n    if (this.flags['fname'])    flg |= Gzip.FlagsMask.FNAME;\n    if (this.flags['fcomment']) flg |= Gzip.FlagsMask.FCOMMENT;\n    if (this.flags['fhcrc'])    flg |= Gzip.FlagsMask.FHCRC;\n    // XXX: FTEXT\n    // XXX: FEXTRA\n    output[op++] = flg;\n\n    // modification time\n    mtime = (Date.now ? Date.now() : +new Date()) / 1000 | 0;\n    output[op++] = mtime        & 0xff;\n    output[op++] = mtime >>>  8 & 0xff;\n    output[op++] = mtime >>> 16 & 0xff;\n    output[op++] = mtime >>> 24 & 0xff;\n\n    // extra flags\n    output[op++] = 0;\n\n    // operating system\n    output[op++] = Gzip.OperatingSystem.UNKNOWN;\n\n    // extra\n    /* NOP */\n\n    // fname\n    if (this.flags['fname'] !== void 0) {\n      for (i = 0, il = filename.length; i < il; ++i) {\n        c = filename.charCodeAt(i);\n        if (c > 0xff) { output[op++] = (c >>> 8) & 0xff; }\n        output[op++] = c & 0xff;\n      }\n      output[op++] = 0; // null termination\n    }\n\n    // fcomment\n    if (this.flags['comment']) {\n      for (i = 0, il = comment.length; i < il; ++i) {\n        c = comment.charCodeAt(i);\n        if (c > 0xff) { output[op++] = (c >>> 8) & 0xff; }\n        output[op++] = c & 0xff;\n      }\n      output[op++] = 0; // null termination\n    }\n\n    // fhcrc\n    if (this.flags['fhcrc']) {\n      crc16 = CRC32.calc(output, 0, op) & 0xffff;\n      output[op++] = (crc16      ) & 0xff;\n      output[op++] = (crc16 >>> 8) & 0xff;\n    }\n\n    // add compress option\n    this.deflateOptions['outputBuffer'] = output;\n    this.deflateOptions['outputIndex'] = op;\n\n    // compress\n    rawdeflate = new RawDeflate(input, this.deflateOptions);\n    output = rawdeflate.compress();\n    op = rawdeflate.op;\n\n    // expand buffer\n    if (USE_TYPEDARRAY) {\n      if (op + 8 > output.buffer.byteLength) {\n        this.output = new Uint8Array(op + 8);\n        this.output.set(new Uint8Array(output.buffer));\n        output = this.output;\n      } else {\n        output = new Uint8Array(output.buffer);\n      }\n    }\n\n    // crc32\n    crc32 = CRC32.calc(input);\n    output[op++] = (crc32       ) & 0xff;\n    output[op++] = (crc32 >>>  8) & 0xff;\n    output[op++] = (crc32 >>> 16) & 0xff;\n    output[op++] = (crc32 >>> 24) & 0xff;\n\n    // input size\n    il = input.length;\n    output[op++] = (il       ) & 0xff;\n    output[op++] = (il >>>  8) & 0xff;\n    output[op++] = (il >>> 16) & 0xff;\n    output[op++] = (il >>> 24) & 0xff;\n\n    this.ip = ip;\n\n    if (USE_TYPEDARRAY && op < output.length) {\n      this.output = output = output.subarray(0, op);\n    }\n\n    return output;\n  };\n\n  /** @enum {number} */\n  Gzip.OperatingSystem = {\n    FAT: 0,\n    AMIGA: 1,\n    VMS: 2,\n    UNIX: 3,\n    VM_CMS: 4,\n    ATARI_TOS: 5,\n    HPFS: 6,\n    MACINTOSH: 7,\n    Z_SYSTEM: 8,\n    CP_M: 9,\n    TOPS_20: 10,\n    NTFS: 11,\n    QDOS: 12,\n    ACORN_RISCOS: 13,\n    UNKNOWN: 255\n  };\n\n  /** @enum {number} */\n  Gzip.FlagsMask = {\n    FTEXT: 0x01,\n    FHCRC: 0x02,\n    FEXTRA: 0x04,\n    FNAME: 0x08,\n    FCOMMENT: 0x10\n  };\n\n\n  return Zlib.Gzip = Gzip;\n\n});\n\n"]}