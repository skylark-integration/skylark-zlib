{"version":3,"sources":["Unzip.js"],"names":["define","Zlib","RawInflate","Zip","Unzip","input","opt_params","this","Array","Uint8Array","ip","eocdrOffset","numberOfThisDisk","startDisk","totalEntriesThisDisk","totalEntries","centralDirectorySize","centralDirectoryOffset","commentLength","comment","fileHeaderList","filenameToIndex","verify","password","CompressionMethod","FileHeaderSignature","LocalFileHeaderSignature","CentralDirectorySignature","FileHeader","offset","length","version","os","needVersion","flags","compression","time","date","crc32","compressedSize","plainSize","fileNameLength","extraFieldLength","fileCommentLength","diskNumberStart","internalFileAttributes","externalFileAttributes","relativeOffset","filename","extraField","prototype","parse","Error","String","fromCharCode","apply","subarray","LocalFileHeader","Flags","searchEndOfCentralDirectoryRecord","parseEndOfCentralDirectoryRecord","parseFileHeader","fileHeader","i","il","filelist","filetable","getFileData","index","localFileHeader","buffer","key","ENCRYPT","createDecryptionKey","decode","STORE","DEFLATE","bufferSize","decompress","CRC32","calc","toString","getFilenames","filenameList","setPassword","n","getByte","updateKeys","createEncryptionKey"],"mappings":"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","file":"../Unzip.js","sourcesContent":["define([\r\n  \"./zlib\",\r\n  \"./crc32\",\r\n  \"./RawInflate\",\r\n  \"./Zip\"\r\n],function(Zlib,RawInflate,Zip) {\r\n  const USE_TYPEDARRAY = true;\r\n\r\n  /**\r\n   * @param {!(Array.<number>|Uint8Array)} input input buffer.\r\n   * @param {Object=} opt_params options.\r\n   * @constructor\r\n   */\r\n  var Unzip = function(input, opt_params) {\r\n    opt_params = opt_params || {};\r\n    /** @type {!(Array.<number>|Uint8Array)} */\r\n    this.input =\r\n      (USE_TYPEDARRAY && (input instanceof Array)) ?\r\n      new Uint8Array(input) : input;\r\n    /** @type {number} */\r\n    this.ip = 0;\r\n    /** @type {number} */\r\n    this.eocdrOffset;\r\n    /** @type {number} */\r\n    this.numberOfThisDisk;\r\n    /** @type {number} */\r\n    this.startDisk;\r\n    /** @type {number} */\r\n    this.totalEntriesThisDisk;\r\n    /** @type {number} */\r\n    this.totalEntries;\r\n    /** @type {number} */\r\n    this.centralDirectorySize;\r\n    /** @type {number} */\r\n    this.centralDirectoryOffset;\r\n    /** @type {number} */\r\n    this.commentLength;\r\n    /** @type {(Array.<number>|Uint8Array)} */\r\n    this.comment;\r\n    /** @type {Array.<Unzip.FileHeader>} */\r\n    this.fileHeaderList;\r\n    /** @type {Object.<string, number>} */\r\n    this.filenameToIndex;\r\n    /** @type {boolean} */\r\n    this.verify = opt_params['verify'] || false;\r\n    /** @type {(Array.<number>|Uint8Array)} */\r\n    this.password = opt_params['password'];\r\n  };\r\n\r\n  Unzip.CompressionMethod = Zip.CompressionMethod;\r\n\r\n  /**\r\n   * @type {Array.<number>}\r\n   * @const\r\n   */\r\n  Unzip.FileHeaderSignature = Zip.FileHeaderSignature;\r\n\r\n  /**\r\n   * @type {Array.<number>}\r\n   * @const\r\n   */\r\n  Unzip.LocalFileHeaderSignature = Zip.LocalFileHeaderSignature;\r\n\r\n  /**\r\n   * @type {Array.<number>}\r\n   * @const\r\n   */\r\n  Unzip.CentralDirectorySignature = Zip.CentralDirectorySignature;\r\n\r\n  /**\r\n   * @param {!(Array.<number>|Uint8Array)} input input buffer.\r\n   * @param {number} ip input position.\r\n   * @constructor\r\n   */\r\n  Unzip.FileHeader = function(input, ip) {\r\n    /** @type {!(Array.<number>|Uint8Array)} */\r\n    this.input = input;\r\n    /** @type {number} */\r\n    this.offset = ip;\r\n    /** @type {number} */\r\n    this.length;\r\n    /** @type {number} */\r\n    this.version;\r\n    /** @type {number} */\r\n    this.os;\r\n    /** @type {number} */\r\n    this.needVersion;\r\n    /** @type {number} */\r\n    this.flags;\r\n    /** @type {number} */\r\n    this.compression;\r\n    /** @type {number} */\r\n    this.time;\r\n    /** @type {number} */\r\n    this.date;\r\n    /** @type {number} */\r\n    this.crc32;\r\n    /** @type {number} */\r\n    this.compressedSize;\r\n    /** @type {number} */\r\n    this.plainSize;\r\n    /** @type {number} */\r\n    this.fileNameLength;\r\n    /** @type {number} */\r\n    this.extraFieldLength;\r\n    /** @type {number} */\r\n    this.fileCommentLength;\r\n    /** @type {number} */\r\n    this.diskNumberStart;\r\n    /** @type {number} */\r\n    this.internalFileAttributes;\r\n    /** @type {number} */\r\n    this.externalFileAttributes;\r\n    /** @type {number} */\r\n    this.relativeOffset;\r\n    /** @type {string} */\r\n    this.filename;\r\n    /** @type {!(Array.<number>|Uint8Array)} */\r\n    this.extraField;\r\n    /** @type {!(Array.<number>|Uint8Array)} */\r\n    this.comment;\r\n  };\r\n\r\n  Unzip.FileHeader.prototype.parse = function() {\r\n    /** @type {!(Array.<number>|Uint8Array)} */\r\n    var input = this.input;\r\n    /** @type {number} */\r\n    var ip = this.offset;\r\n\r\n    // central file header signature\r\n    if (input[ip++] !== Unzip.FileHeaderSignature[0] ||\r\n        input[ip++] !== Unzip.FileHeaderSignature[1] ||\r\n        input[ip++] !== Unzip.FileHeaderSignature[2] ||\r\n        input[ip++] !== Unzip.FileHeaderSignature[3]) {\r\n      throw new Error('invalid file header signature');\r\n    }\r\n\r\n    // version made by\r\n    this.version = input[ip++];\r\n    this.os = input[ip++];\r\n\r\n    // version needed to extract\r\n    this.needVersion = input[ip++] | (input[ip++] << 8);\r\n\r\n    // general purpose bit flag\r\n    this.flags = input[ip++] | (input[ip++] << 8);\r\n\r\n    // compression method\r\n    this.compression = input[ip++] | (input[ip++] << 8);\r\n\r\n    // last mod file time\r\n    this.time = input[ip++] | (input[ip++] << 8);\r\n\r\n    //last mod file date\r\n    this.date = input[ip++] | (input[ip++] << 8);\r\n\r\n    // crc-32\r\n    this.crc32 = (\r\n      (input[ip++]      ) | (input[ip++] <<  8) |\r\n      (input[ip++] << 16) | (input[ip++] << 24)\r\n    ) >>> 0;\r\n\r\n    // compressed size\r\n    this.compressedSize = (\r\n      (input[ip++]      ) | (input[ip++] <<  8) |\r\n      (input[ip++] << 16) | (input[ip++] << 24)\r\n    ) >>> 0;\r\n\r\n    // uncompressed size\r\n    this.plainSize = (\r\n      (input[ip++]      ) | (input[ip++] <<  8) |\r\n      (input[ip++] << 16) | (input[ip++] << 24)\r\n    ) >>> 0;\r\n\r\n    // file name length\r\n    this.fileNameLength = input[ip++] | (input[ip++] << 8);\r\n\r\n    // extra field length\r\n    this.extraFieldLength = input[ip++] | (input[ip++] << 8);\r\n\r\n    // file comment length\r\n    this.fileCommentLength = input[ip++] | (input[ip++] << 8);\r\n\r\n    // disk number start\r\n    this.diskNumberStart = input[ip++] | (input[ip++] << 8);\r\n\r\n    // internal file attributes\r\n    this.internalFileAttributes = input[ip++] | (input[ip++] << 8);\r\n\r\n    // external file attributes\r\n    this.externalFileAttributes =\r\n      (input[ip++]      ) | (input[ip++] <<  8) |\r\n      (input[ip++] << 16) | (input[ip++] << 24);\r\n\r\n    // relative offset of local header\r\n    this.relativeOffset = (\r\n      (input[ip++]      ) | (input[ip++] <<  8) |\r\n      (input[ip++] << 16) | (input[ip++] << 24)\r\n    ) >>> 0;\r\n\r\n    // file name\r\n    this.filename = String.fromCharCode.apply(null, USE_TYPEDARRAY ?\r\n      input.subarray(ip, ip += this.fileNameLength) :\r\n      input.slice(ip, ip += this.fileNameLength)\r\n    );\r\n\r\n    // extra field\r\n    this.extraField = USE_TYPEDARRAY ?\r\n      input.subarray(ip, ip += this.extraFieldLength) :\r\n      input.slice(ip, ip += this.extraFieldLength);\r\n\r\n    // file comment\r\n    this.comment = USE_TYPEDARRAY ?\r\n      input.subarray(ip, ip + this.fileCommentLength) :\r\n      input.slice(ip, ip + this.fileCommentLength);\r\n\r\n    this.length = ip - this.offset;\r\n  };\r\n\r\n  /**\r\n   * @param {!(Array.<number>|Uint8Array)} input input buffer.\r\n   * @param {number} ip input position.\r\n   * @constructor\r\n   */\r\n  Unzip.LocalFileHeader = function(input, ip) {\r\n    /** @type {!(Array.<number>|Uint8Array)} */\r\n    this.input = input;\r\n    /** @type {number} */\r\n    this.offset = ip;\r\n    /** @type {number} */\r\n    this.length;\r\n    /** @type {number} */\r\n    this.needVersion;\r\n    /** @type {number} */\r\n    this.flags;\r\n    /** @type {number} */\r\n    this.compression;\r\n    /** @type {number} */\r\n    this.time;\r\n    /** @type {number} */\r\n    this.date;\r\n    /** @type {number} */\r\n    this.crc32;\r\n    /** @type {number} */\r\n    this.compressedSize;\r\n    /** @type {number} */\r\n    this.plainSize;\r\n    /** @type {number} */\r\n    this.fileNameLength;\r\n    /** @type {number} */\r\n    this.extraFieldLength;\r\n    /** @type {string} */\r\n    this.filename;\r\n    /** @type {!(Array.<number>|Uint8Array)} */\r\n    this.extraField;\r\n  };\r\n\r\n  Unzip.LocalFileHeader.Flags = Zip.Flags;\r\n\r\n  Unzip.LocalFileHeader.prototype.parse = function() {\r\n    /** @type {!(Array.<number>|Uint8Array)} */\r\n    var input = this.input;\r\n    /** @type {number} */\r\n    var ip = this.offset;\r\n\r\n    // local file header signature\r\n    if (input[ip++] !== Unzip.LocalFileHeaderSignature[0] ||\r\n        input[ip++] !== Unzip.LocalFileHeaderSignature[1] ||\r\n        input[ip++] !== Unzip.LocalFileHeaderSignature[2] ||\r\n        input[ip++] !== Unzip.LocalFileHeaderSignature[3]) {\r\n      throw new Error('invalid local file header signature');\r\n    }\r\n\r\n    // version needed to extract\r\n    this.needVersion = input[ip++] | (input[ip++] << 8);\r\n\r\n    // general purpose bit flag\r\n    this.flags = input[ip++] | (input[ip++] << 8);\r\n\r\n    // compression method\r\n    this.compression = input[ip++] | (input[ip++] << 8);\r\n\r\n    // last mod file time\r\n    this.time = input[ip++] | (input[ip++] << 8);\r\n\r\n    //last mod file date\r\n    this.date = input[ip++] | (input[ip++] << 8);\r\n\r\n    // crc-32\r\n    this.crc32 = (\r\n      (input[ip++]      ) | (input[ip++] <<  8) |\r\n      (input[ip++] << 16) | (input[ip++] << 24)\r\n    ) >>> 0;\r\n\r\n    // compressed size\r\n    this.compressedSize = (\r\n      (input[ip++]      ) | (input[ip++] <<  8) |\r\n      (input[ip++] << 16) | (input[ip++] << 24)\r\n    ) >>> 0;\r\n\r\n    // uncompressed size\r\n    this.plainSize = (\r\n      (input[ip++]      ) | (input[ip++] <<  8) |\r\n      (input[ip++] << 16) | (input[ip++] << 24)\r\n    ) >>> 0;\r\n\r\n    // file name length\r\n    this.fileNameLength = input[ip++] | (input[ip++] << 8);\r\n\r\n    // extra field length\r\n    this.extraFieldLength = input[ip++] | (input[ip++] << 8);\r\n\r\n    // file name\r\n    this.filename = String.fromCharCode.apply(null, USE_TYPEDARRAY ?\r\n      input.subarray(ip, ip += this.fileNameLength) :\r\n      input.slice(ip, ip += this.fileNameLength)\r\n    );\r\n\r\n    // extra field\r\n    this.extraField = USE_TYPEDARRAY ?\r\n      input.subarray(ip, ip += this.extraFieldLength) :\r\n      input.slice(ip, ip += this.extraFieldLength);\r\n\r\n    this.length = ip - this.offset;\r\n  };\r\n\r\n\r\n  Unzip.prototype.searchEndOfCentralDirectoryRecord = function() {\r\n    /** @type {!(Array.<number>|Uint8Array)} */\r\n    var input = this.input;\r\n    /** @type {number} */\r\n    var ip;\r\n\r\n    for (ip = input.length - 12; ip > 0; --ip) {\r\n      if (input[ip  ] === Unzip.CentralDirectorySignature[0] &&\r\n          input[ip+1] === Unzip.CentralDirectorySignature[1] &&\r\n          input[ip+2] === Unzip.CentralDirectorySignature[2] &&\r\n          input[ip+3] === Unzip.CentralDirectorySignature[3]) {\r\n        this.eocdrOffset = ip;\r\n        return;\r\n      }\r\n    }\r\n\r\n    throw new Error('End of Central Directory Record not found');\r\n  };\r\n\r\n  Unzip.prototype.parseEndOfCentralDirectoryRecord = function() {\r\n    /** @type {!(Array.<number>|Uint8Array)} */\r\n    var input = this.input;\r\n    /** @type {number} */\r\n    var ip;\r\n\r\n    if (!this.eocdrOffset) {\r\n      this.searchEndOfCentralDirectoryRecord();\r\n    }\r\n    ip = this.eocdrOffset;\r\n\r\n    // signature\r\n    if (input[ip++] !== Unzip.CentralDirectorySignature[0] ||\r\n        input[ip++] !== Unzip.CentralDirectorySignature[1] ||\r\n        input[ip++] !== Unzip.CentralDirectorySignature[2] ||\r\n        input[ip++] !== Unzip.CentralDirectorySignature[3]) {\r\n      throw new Error('invalid signature');\r\n    }\r\n\r\n    // number of this disk\r\n    this.numberOfThisDisk = input[ip++] | (input[ip++] << 8);\r\n\r\n    // number of the disk with the start of the central directory\r\n    this.startDisk = input[ip++] | (input[ip++] << 8);\r\n\r\n    // total number of entries in the central directory on this disk\r\n    this.totalEntriesThisDisk = input[ip++] | (input[ip++] << 8);\r\n\r\n    // total number of entries in the central directory\r\n    this.totalEntries = input[ip++] | (input[ip++] << 8);\r\n\r\n    // size of the central directory\r\n    this.centralDirectorySize = (\r\n      (input[ip++]      ) | (input[ip++] <<  8) |\r\n      (input[ip++] << 16) | (input[ip++] << 24)\r\n    ) >>> 0;\r\n\r\n    // offset of start of central directory with respect to the starting disk number\r\n    this.centralDirectoryOffset = (\r\n      (input[ip++]      ) | (input[ip++] <<  8) |\r\n      (input[ip++] << 16) | (input[ip++] << 24)\r\n    ) >>> 0;\r\n\r\n    // .ZIP file comment length\r\n    this.commentLength = input[ip++] | (input[ip++] << 8);\r\n\r\n    // .ZIP file comment\r\n    this.comment = USE_TYPEDARRAY ?\r\n      input.subarray(ip, ip + this.commentLength) :\r\n      input.slice(ip, ip + this.commentLength);\r\n  };\r\n\r\n  Unzip.prototype.parseFileHeader = function() {\r\n    /** @type {Array.<Unzip.FileHeader>} */\r\n    var filelist = [];\r\n    /** @type {Object.<string, number>} */\r\n    var filetable = {};\r\n    /** @type {number} */\r\n    var ip;\r\n    /** @type {Unzip.FileHeader} */\r\n    var fileHeader;\r\n    /*: @type {number} */\r\n    var i;\r\n    /*: @type {number} */\r\n    var il;\r\n\r\n    if (this.fileHeaderList) {\r\n      return;\r\n    }\r\n\r\n    if (this.centralDirectoryOffset === void 0) {\r\n      this.parseEndOfCentralDirectoryRecord();\r\n    }\r\n    ip = this.centralDirectoryOffset;\r\n\r\n    for (i = 0, il = this.totalEntries; i < il; ++i) {\r\n      fileHeader = new Unzip.FileHeader(this.input, ip);\r\n      fileHeader.parse();\r\n      ip += fileHeader.length;\r\n      filelist[i] = fileHeader;\r\n      filetable[fileHeader.filename] = i;\r\n    }\r\n\r\n    if (this.centralDirectorySize < ip - this.centralDirectoryOffset) {\r\n      throw new Error('invalid file header size');\r\n    }\r\n\r\n    this.fileHeaderList = filelist;\r\n    this.filenameToIndex = filetable;\r\n  };\r\n\r\n  /**\r\n   * @param {number} index file header index.\r\n   * @param {Object=} opt_params\r\n   * @return {!(Array.<number>|Uint8Array)} file data.\r\n   */\r\n  Unzip.prototype.getFileData = function(index, opt_params) {\r\n    opt_params = opt_params || {};\r\n    /** @type {!(Array.<number>|Uint8Array)} */\r\n    var input = this.input;\r\n    /** @type {Array.<Unzip.FileHeader>} */\r\n    var fileHeaderList = this.fileHeaderList;\r\n    /** @type {Unzip.LocalFileHeader} */\r\n    var localFileHeader;\r\n    /** @type {number} */\r\n    var offset;\r\n    /** @type {number} */\r\n    var length;\r\n    /** @type {!(Array.<number>|Uint8Array)} */\r\n    var buffer;\r\n    /** @type {number} */\r\n    var crc32;\r\n    /** @type {Array.<number>|Uint32Array|Object} */\r\n    var key;\r\n    /** @type {number} */\r\n    var i;\r\n    /** @type {number} */\r\n    var il;\r\n\r\n    if (!fileHeaderList) {\r\n      this.parseFileHeader();\r\n    }\r\n\r\n    if (fileHeaderList[index] === void 0) {\r\n      throw new Error('wrong index');\r\n    }\r\n\r\n    offset = fileHeaderList[index].relativeOffset;\r\n    localFileHeader = new Unzip.LocalFileHeader(this.input, offset);\r\n    localFileHeader.parse();\r\n    offset += localFileHeader.length;\r\n    length = localFileHeader.compressedSize;\r\n\r\n    // decryption\r\n    if ((localFileHeader.flags & Unzip.LocalFileHeader.Flags.ENCRYPT) !== 0) {\r\n      if (!(opt_params['password'] || this.password)) {\r\n        throw new Error('please set password');\r\n      }\r\n      key =  this.createDecryptionKey(opt_params['password'] || this.password);\r\n\r\n      // encryption header\r\n      for(i = offset, il = offset + 12; i < il; ++i) {\r\n        this.decode(key, input[i]);\r\n      }\r\n      offset += 12;\r\n      length -= 12;\r\n\r\n      // decryption\r\n      for (i = offset, il = offset + length; i < il; ++i) {\r\n        input[i] = this.decode(key, input[i]);\r\n      }\r\n    }\r\n\r\n    switch (localFileHeader.compression) {\r\n      case Unzip.CompressionMethod.STORE:\r\n        buffer = USE_TYPEDARRAY ?\r\n          this.input.subarray(offset, offset + length) :\r\n          this.input.slice(offset, offset + length);\r\n        break;\r\n      case Unzip.CompressionMethod.DEFLATE:\r\n        buffer = new RawInflate(this.input, {\r\n          'index': offset,\r\n          'bufferSize': localFileHeader.plainSize\r\n        }).decompress();\r\n        break;\r\n      default:\r\n        throw new Error('unknown compression type');\r\n    }\r\n\r\n    if (this.verify) {\r\n      crc32 = CRC32.calc(buffer);\r\n      if (localFileHeader.crc32 !== crc32) {\r\n        throw new Error(\r\n          'wrong crc: file=0x' + localFileHeader.crc32.toString(16) +\r\n          ', data=0x' + crc32.toString(16)\r\n        );\r\n      }\r\n    }\r\n\r\n    return buffer;\r\n  };\r\n\r\n  /**\r\n   * @return {Array.<string>}\r\n   */\r\n  Unzip.prototype.getFilenames = function() {\r\n    /** @type {Array.<string>} */\r\n    var filenameList = [];\r\n    /** @type {number} */\r\n    var i;\r\n    /** @type {number} */\r\n    var il;\r\n    /** @type {Array.<Unzip.FileHeader>} */\r\n    var fileHeaderList;\r\n\r\n    if (!this.fileHeaderList) {\r\n      this.parseFileHeader();\r\n    }\r\n    fileHeaderList = this.fileHeaderList;\r\n\r\n    for (i = 0, il = fileHeaderList.length; i < il; ++i) {\r\n      filenameList[i] = fileHeaderList[i].filename;\r\n    }\r\n\r\n    return filenameList;\r\n  };\r\n\r\n  /**\r\n   * @param {string} filename extract filename.\r\n   * @param {Object=} opt_params\r\n   * @return {!(Array.<number>|Uint8Array)} decompressed data.\r\n   */\r\n  Unzip.prototype.decompress = function(filename, opt_params) {\r\n    /** @type {number} */\r\n    var index;\r\n\r\n    if (!this.filenameToIndex) {\r\n      this.parseFileHeader();\r\n    }\r\n    index = this.filenameToIndex[filename];\r\n\r\n    if (index === void 0) {\r\n      throw new Error(filename + ' not found');\r\n    }\r\n\r\n    return this.getFileData(index, opt_params);\r\n  };\r\n\r\n  /**\r\n   * @param {(Array.<number>|Uint8Array)} password\r\n   */\r\n  Unzip.prototype.setPassword = function(password) {\r\n    this.password = password;\r\n  };\r\n\r\n  /**\r\n   * @param {(Array.<number>|Uint32Array|Object)} key\r\n   * @param {number} n\r\n   * @return {number}\r\n   */\r\n  Unzip.prototype.decode = function(key, n) {\r\n    n ^= this.getByte(/** @type {(Array.<number>|Uint32Array)} */(key));\r\n    this.updateKeys(/** @type {(Array.<number>|Uint32Array)} */(key), n);\r\n\r\n    return n;\r\n  };\r\n\r\n  // common method\r\n  Unzip.prototype.updateKeys = Zip.prototype.updateKeys;\r\n  Unzip.prototype.createDecryptionKey = Zip.prototype.createEncryptionKey;\r\n  Unzip.prototype.getByte = Zip.prototype.getByte;\r\n\r\n  return Zlib.Unzip = Unzip;\r\n\r\n});\r\n\r\n\r\n"]}