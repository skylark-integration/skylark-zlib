/**
 * skylark-zlib - A version of zlib.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-zlib/
 * @license MIT
 */
define(["./zlib","./huffman"],function(t,e){var i,r=e.buildHuffmanTable,a=function(t,e){switch(this.buffer,this.blocks=[],this.bufferSize=32768,this.totalpos=0,this.ip=0,this.bitsbuf=0,this.bitsbuflen=0,this.input=new Uint8Array(t),this.output,this.op,this.bfinal=!1,this.bufferType=a.BufferType.ADAPTIVE,this.resize=!1,!e&&(e={})||(e.index&&(this.ip=e.index),e.bufferSize&&(this.bufferSize=e.bufferSize),e.bufferType&&(this.bufferType=e.bufferType),e.resize&&(this.resize=e.resize)),this.bufferType){case a.BufferType.BLOCK:this.op=a.MaxBackwardLength,this.output=new Uint8Array(a.MaxBackwardLength+this.bufferSize+a.MaxCopyLength);break;case a.BufferType.ADAPTIVE:this.op=0,this.output=new Uint8Array(this.bufferSize),this.expandBuffer=this.expandBufferAdaptive,this.concatBuffer=this.concatBufferDynamic,this.decodeHuffman=this.decodeHuffmanAdaptive;break;default:throw new Error("invalid inflate mode")}};return a.BufferType={BLOCK:0,ADAPTIVE:1},a.prototype.decompress=function(){for(;!this.bfinal;)this.parseBlock();return this.concatBuffer()},a.MaxBackwardLength=32768,a.MaxCopyLength=258,a.Order=(i=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],new Uint16Array(i)),a.LengthCodeTable=function(t){return new Uint16Array(t)}([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),a.LengthExtraTable=function(t){return new Uint8Array(t)}([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),a.DistCodeTable=function(t){return new Uint16Array(t)}([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]),a.DistExtraTable=function(t){return new Uint8Array(t)}([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),a.FixedLiteralLengthTable=function(){var t,e,i=new Uint8Array(288);for(t=0,e=i.length;t<e;++t)i[t]=t<=143?8:t<=255?9:t<=279?7:8;return r(i)}(),a.FixedDistanceTable=function(){var t,e,i=new Uint8Array(30);for(t=0,e=i.length;t<e;++t)i[t]=5;return r(i)}(),a.prototype.parseBlock=function(){var t=this.readBits(3);switch(1&t&&(this.bfinal=!0),t>>>=1){case 0:this.parseUncompressedBlock();break;case 1:this.parseFixedHuffmanBlock();break;case 2:this.parseDynamicHuffmanBlock();break;default:throw new Error("unknown BTYPE: "+t)}},a.prototype.readBits=function(t){for(var e,i=this.bitsbuf,r=this.bitsbuflen,a=this.input,s=this.ip,n=a.length;r<t;){if(s>=n)throw new Error("input buffer is broken");i|=a[s++]<<r,r+=8}return e=i&(1<<t)-1,i>>>=t,r-=t,this.bitsbuf=i,this.bitsbuflen=r,this.ip=s,e},a.prototype.readCodeByTable=function(t){for(var e,i,r=this.bitsbuf,a=this.bitsbuflen,s=this.input,n=this.ip,h=s.length,o=t[0],f=t[1];a<f&&!(n>=h);)r|=s[n++]<<a,a+=8;if((i=(e=o[r&(1<<f)-1])>>>16)>a)throw new Error("invalid code length: "+i);return this.bitsbuf=r>>i,this.bitsbuflen=a-i,this.ip=n,65535&e},a.prototype.parseUncompressedBlock=function(){var t,e,i=this.input,r=this.ip,s=this.output,n=this.op,h=i.length,o=s.length;if(this.bitsbuf=0,this.bitsbuflen=0,r+1>=h)throw new Error("invalid uncompressed block header: LEN");if(t=i[r++]|i[r++]<<8,r+1>=h)throw new Error("invalid uncompressed block header: NLEN");if(t===~(i[r++]|i[r++]<<8))throw new Error("invalid uncompressed block header: length verify");if(r+t>i.length)throw new Error("input buffer is broken");switch(this.bufferType){case a.BufferType.BLOCK:for(;n+t>s.length;)t-=e=o-n,s.set(i.subarray(r,r+e),n),n+=e,r+=e,this.op=n,s=this.expandBuffer(),n=this.op;break;case a.BufferType.ADAPTIVE:for(;n+t>s.length;)s=this.expandBuffer({fixRatio:2});break;default:throw new Error("invalid inflate mode")}s.set(i.subarray(r,r+t),n),n+=t,r+=t,this.ip=r,this.op=n,this.output=s},a.prototype.parseFixedHuffmanBlock=function(){this.decodeHuffman(a.FixedLiteralLengthTable,a.FixedDistanceTable)},a.prototype.parseDynamicHuffmanBlock=function(){var t,e,i,s,n,h,o,f,u,p=this.readBits(5)+257,b=this.readBits(5)+1,l=this.readBits(4)+4,d=new Uint8Array(a.Order.length);for(f=0;f<l;++f)d[a.Order[f]]=this.readBits(3);for(t=r(d),s=new Uint8Array(p+b),f=0,u=p+b;f<u;)switch(n=this.readCodeByTable(t)){case 16:for(o=3+this.readBits(2);o--;)s[f++]=h;break;case 17:for(o=3+this.readBits(3);o--;)s[f++]=0;h=0;break;case 18:for(o=11+this.readBits(7);o--;)s[f++]=0;h=0;break;default:s[f++]=n,h=n}e=r(s.subarray(0,p)),i=r(s.subarray(p)),this.decodeHuffman(e,i)},a.prototype.decodeHuffman=function(t,e){var i=this.output,r=this.op;this.currentLitlenTable=t;for(var s,n,h,o,f=i.length-a.MaxCopyLength;256!==(s=this.readCodeByTable(t));)if(s<256)r>=f&&(this.op=r,i=this.expandBuffer(),r=this.op),i[r++]=s;else for(n=s-257,o=a.LengthCodeTable[n],a.LengthExtraTable[n]>0&&(o+=this.readBits(a.LengthExtraTable[n])),s=this.readCodeByTable(e),h=a.DistCodeTable[s],a.DistExtraTable[s]>0&&(h+=this.readBits(a.DistExtraTable[s])),r>=f&&(this.op=r,i=this.expandBuffer(),r=this.op);o--;)i[r]=i[r++-h];for(;this.bitsbuflen>=8;)this.bitsbuflen-=8,this.ip--;this.op=r},a.prototype.decodeHuffmanAdaptive=function(t,e){var i=this.output,r=this.op;this.currentLitlenTable=t;for(var s,n,h,o,f=i.length;256!==(s=this.readCodeByTable(t));)if(s<256)r>=f&&(f=(i=this.expandBuffer()).length),i[r++]=s;else for(n=s-257,o=a.LengthCodeTable[n],a.LengthExtraTable[n]>0&&(o+=this.readBits(a.LengthExtraTable[n])),s=this.readCodeByTable(e),h=a.DistCodeTable[s],a.DistExtraTable[s]>0&&(h+=this.readBits(a.DistExtraTable[s])),r+o>f&&(f=(i=this.expandBuffer()).length);o--;)i[r]=i[r++-h];for(;this.bitsbuflen>=8;)this.bitsbuflen-=8,this.ip--;this.op=r},a.prototype.expandBuffer=function(t){var e=new Uint8Array(this.op-a.MaxBackwardLength),i=this.op-a.MaxBackwardLength,r=this.output;return e.set(r.subarray(a.MaxBackwardLength,e.length)),this.blocks.push(e),this.totalpos+=e.length,r.set(r.subarray(i,i+a.MaxBackwardLength)),this.op=a.MaxBackwardLength,r},a.prototype.expandBufferAdaptive=function(t){var e,i,r,a=this.input.length/this.ip+1|0,s=this.input,n=this.output;return t&&("number"==typeof t.fixRatio&&(a=t.fixRatio),"number"==typeof t.addRatio&&(a+=t.addRatio)),i=a<2?(r=(s.length-this.ip)/this.currentLitlenTable[2]/2*258|0)<n.length?n.length+r:n.length<<1:n.length*a,(e=new Uint8Array(i)).set(n),this.output=e,this.output},a.prototype.concatBuffer=function(){var t,e,i,r,s,n=0,h=this.totalpos+(this.op-a.MaxBackwardLength),o=this.output,f=this.blocks,u=new Uint8Array(h);if(0===f.length)return this.output.subarray(a.MaxBackwardLength,this.op);for(e=0,i=f.length;e<i;++e)for(r=0,s=(t=f[e]).length;r<s;++r)u[n++]=t[r];for(e=a.MaxBackwardLength,i=this.op;e<i;++e)u[n++]=o[e];return this.blocks=[],this.buffer=u,this.buffer},a.prototype.concatBufferDynamic=function(){var t,e=this.op;return this.resize?(t=new Uint8Array(e)).set(this.output.subarray(0,e)):t=this.output.subarray(0,e),this.buffer=t,this.buffer},t.RawInflate=a});
//# sourceMappingURL=sourcemaps/RawInflate.js.map
